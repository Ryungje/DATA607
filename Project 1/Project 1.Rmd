---
title: "Project 1"
author: "James Chun"
date: "September 19, 2025"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Install Packages

```{r}
#install.packages("tidyverse)
library(tidyverse)
```


## Import Tournament Information
Importing the entire txt file as a string to be parsed later on.

```{r}
raw_tourn_info <- readChar("tournamentinfo.txt", file.info("tournamentinfo.txt")$size)
```   


## Processing String
Splitting the string using regular expressions. 

1. Split each player row. The player rows are separated by a line of dashes and the escaped characters "\r\n". 

```{r}
# Split player rows
tourn_info <- str_split(raw_tourn_info, "-+\r\n")[[1]]
tourn_info <- tourn_info[c(-1,-2)] #Drop irrelevant first indices
```

2. Initialize the dataframe. 

```{r}
# Initialize dataframe
tourn_data <- data.frame(matrix(ncol=5, nrow=length(tourn_info)))
colnames(tourn_data) <- c("Name", "State", "Total Points", "Pre-Rating", "Avg Opponent Pre-Rating")
```

3. Loop through tournament information string vector and parse necessary player information. Inside the loop, the Avg Opp Pre-Rating will also be calculated. 

```{r}
for (i in 1:length(tourn_info)){
  # create temp vector to keep track of information
  temp <- c(NA,NA,NA,NA,NA)
  
  # Capture Name
  temp[1] <- str_match(tourn_info[i], "\\|\\s*([A-Za-z\\- ]+?)\\s*\\|")[,2]
  
  # Capture State
  temp[2] <- str_match(tourn_info[i], "\\|\\r\\n\\s*([A-Z]+?)\\s*\\|")[,2]
  
  # Capture Total Points
  temp[3] <- str_match(tourn_info[i], "\\|(\\d+\\.\\d+)\\s*\\|")[,2]
  
  # Capture Pre-Rating
  temp[4] <- str_match(tourn_info[i], "R:\\s*(\\d+)(P\\d+)?\\s*->")[,2]
  
  
  # Find all faced opponents
  round_opps <- tourn_info[i] %>%
    str_extract_all(., "[WDLH]\\s+\\d+") %>%
    .[[1]] %>% 
    str_extract("\\d+")
  
  # Avg Opp Pre-Rating calculation
  sum <- round_opps %>% 
    as.numeric() %>%
    tourn_info[.] %>% 
    str_match(., "R:\\s*(\\d+)(P\\d+)?\\s*->") %>%
    .[,2] %>%
    as.numeric() %>%
    sum()

  temp[5] <- (sum / length(round_opps)) %>% 
    round() %>% 
    as.character()
  

  # Fill table row
  tourn_data[i,] <- temp
  
}
```


## Export CSV File

```{r}
write.csv(tourn_data, "Chess Tournament Data.csv")
```

