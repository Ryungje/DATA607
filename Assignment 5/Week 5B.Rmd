---
title: "Week 5B"
author: "James Chun"
date: "2025-09-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ELO Calculations

## Install Packages
```{r, warning = FALSE}
library(tidyverse)
library(dplyr)
```


## Import Chess Tournament Data
```{r}
chess_data <- read.csv("Chess Tournament Data.csv")
chess_data <- chess_data[,-1]

```


## Parsing Tournament Info
Need to extract the players faced each round for each player. Borrowing some code from Project 1. 

```{r, warning = FALSE}
# First prep chess_data to allow for new data
chess_data$Expected.Score <- NA
chess_data$Score.Diff <- NA


# Import Raw Tournament Info
raw_tourn_info <- readChar("tournamentinfo.txt", file.info("tournamentinfo.txt")$size)

# Split player rows
tourn_info <- str_split(raw_tourn_info, "-+\r\n")[[1]]
tourn_info <- tourn_info[c(-1,-2)] #Drop irrelevant first indices


# Parse each row in tourn_info and extract necessary information
for (i in 1:length(tourn_info)){
  
  # Find all faced opponents
  round_opps <- tourn_info[i] %>%
      str_extract_all(., "[WDLH]\\s+\\d+") %>%
      .[[1]] %>% 
      str_extract("\\d+")
  
  
  # Current Pre-Rating
  Ra <- chess_data[i,"Pre.Rating"] #replace 1 with i
  
  # Get pre-ratings for all faced opponents
  Rb <- chess_data[round_opps,"Pre.Rating"]
  
  # Other formula pieces
  Qa <- 10 ^ (Ra/400)
  Qb <- 10 ^ (Rb/400) 
  
  # Calculate expected score
  Ea <- sum(Qa / (Qa + Qb)) %>% round(2)
  
  # Populate appropriate columns in chess_data
  chess_data$Expected.Score[i] <- Ea
  chess_data$Score.Diff[i] <- chess_data$Total.Points[i] - Ea
  
}

head(chess_data)
```

## Basic Analysis

```{r}
# Top 5 performing players relative to their expected score
arrange(chess_data, desc(chess_data$Score.Diff)) %>%
  head(5)

```

```{r}
# Top 5 under-performing players relative to their expected score
arrange(chess_data, chess_data$Score.Diff) %>%
  head(5)
```

.\
.\
.\
.\

Scratch Notes

using https://stanislav-stankovic.medium.com/elo-rating-system-6196cc59941e for formula

Imagine that two players, we shall denote them as player A and player B are playing a PvP match against each other. These two players will have their corresponding Elo ratings, Ra, and Rb respectively
   - set Ra as main player, and Rb as each round

The expected outcome of a match Ea = Qa /(Qa + Qb), Qa = 10^(Ra/c), Qb = 10^(Rb/c), 0 ≤ Ea ≤ 1.

The actual outcome of the match Sa = 1 in the case of a win, Sa = 0 and in the case of a loss, and Sa = 0.5 in the case of a draw,



